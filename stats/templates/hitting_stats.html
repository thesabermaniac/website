{% extends 'base.html' %}
{% load my_tags %}

{% block title %}Hitting | The Sabermaniac{% endblock %}

{% block content %}
    <div class="cover" style="position: fixed; height: 100%; width: 100%; top:0; left: 0; z-index:9999; background: white;"></div>
    </div>
    <div style="padding-top: 50px">
        <form action="/stats/hitting" method="get" style="margin-top: 100px">
            <ul style="list-style: none; display: block; text-align: center; margin-bottom: 2.5em; padding: 0 10% 0 10%">
                <li style="width: fit-content; display: inline-block">
                    <div class="dropdown">
                        <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Included Stats
                        </button>
                        <select name="include" class="multiselect dropdown-menu" multiple="multiple" aria-labelledby="dropdownMenuButton" style="width: 100px; white-space: normal; height: 240px; overflow: hidden">
                            {% for field in field_names %}
                                {% if field|slice:'1' != 'f' and field != 'id' and field != 'player' and field != 'year' and field != 'is_projection'%}
                                    <option value="{{ field }}" {% if field in included_field_names %}selected{% endif %}>{{ field|capfirst }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </li>
                <li style="width: fit-content; display: inline-block">
                    <div class="dropdown">
                        <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Year
                        </button>
                        <select name="year" class="multiselect dropdown-menu" multiple="multiple" aria-labelledby="dropdownMenuButton" style="white-space: normal; overflow: hidden">
                            {% for year in year_list %}
                                <option value="{{ year }}" {% if year|slugify in request.GET.year %}selected{% endif %}>{{ year }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </li>
                <li style="width: fit-content; display: inline-block; position: absolute; margin-left: 5px">
                    <input type="text" value="{% if request.GET.min_pa %}{{ request.GET.min_pa }}{% endif %}" class="form-control min_pa" placeholder="Minimum PA" name="min_pa" aria-label="Username" aria-describedby="basic-addon1" style="border-color: #398252; background-color: #c5e8d1">
                </li>
                <li style="width: fit-content; display: inline-block; margin-left: 215px">
                    <button type="submit" class="btn btn-success btn-sm">Search</button>
                </li>
            </ul>
        </form>
    </div>
    <div style="width: 90%; margin: 0 auto; height: 100vh;">
        <table id="hitting-stats" class="table table-striped table-bordered">
            <thead>
                <tr>
                    {% for field in included_field_names %}
                        {% if field != 'id' and field != 'is_projection'%}
                            <th scope="col">{{ field|capfirst }}</th>
                        {% endif %}
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for stat in object_list %}
                    <tr>
                        {% for field in stat.get_field_names_and_values %}
                            {% if field.name in included_field_names%}
                                {% if field.name == 'AVG' or field.name == 'OBP' or field.name == 'OPS' %}
                                    <td>{{ field.value|floatformat:3 }}</td>
                                {% elif field.value != None and field.name != 'id' and field.name != 'is_projection' and field.name != 'fTotal'%}
                                    <td>{{ field.value }}</td>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <td>{{ stat|fTotal:context }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <style>
        .multiselect option::before{
            content: '\2610';
            width: 1.3em;
            display: inline-block;
            margin-left: 2px;
        }
        .multiselect option:checked::before{
            content: "\2611";
        }
        .multiselect option{
            display:inline-table;
            width: 50%
        }
        td{white-space: nowrap}
        .nav{position: fixed; width: 100%; top: 0; background: white; z-index: 9}
        table.dataTable thead .sorting, table.dataTable thead .sorting_asc, table.dataTable thead .sorting_desc{background-image: unset}
        .dataTables_wrapper .dataTables_paginate .paginate_button{padding: unset;}
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover{border: none; background: none}
        #hitting-stats_wrapper .col-sm-12{overflow: auto}
        .btn-success{background-color: #398252; border-color: #398252}
        .form-control::placeholder{color: #398252}
        .form-control{color: #398252}
        .min_pa::before{content: 'Minimum PA'}
    </style>
{% endblock %}

{% block extra_js %}
    <script>
        $(document).ready(function () {
            $('.hitting').addClass('active');
            $('option').mousedown(function(e) {
                e.preventDefault();
                $(this).prop('selected', !$(this).prop('selected'));
                return false;
            });
            var index = $('#hitting-stats').find('th:last').index();
            $('#hitting-stats').DataTable({
                "lengthMenu": [[10, 25, 50, 100, 250, -1], [10, 25, 50, 100, 250, "All"]],
                "order": [[index, 'desc']]
            });
            $('.cover').hide()
        })
        $(document).on('click', '.dropdown-menu', function (e) {
            e.stopPropagation();
        });
    </script>
{% endblock %}